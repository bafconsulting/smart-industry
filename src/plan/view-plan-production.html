<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../view-index.html">
<link rel="import" href="../shared-styles.html">
<dom-module id="view-plan-production">
  <template>
    <style include="shared-styles">
       :host {
        display: block;
        --app-grid-item-height: 50%;
        --vaadin-context-menu-overlay: {
          background-color: #ffffff;
        }
      }

      @media (min-width: 360px) and (max-width: 768px) {
         :host {
          --app-grid-columns: 3;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
         :host {
          --app-grid-columns: 3;
        }
      }

      @media (min-width: 1025px) and (max-width: 1200px) {
         :host {
          --app-grid-columns: 3;
        }
      }

      @media (min-width: 1201px) and (max-width: 2560px) {
         :host {
          --app-grid-columns: 3;
        }
      }

      paper-item:hover { color: #FFFFFF; background-color: #333333; }
      li {
         display: block;
      }

     .frame {
        border: solid 1px #757575;
        border-radius: 2px; 
        margin: 10px; 
        min-height: 350px; 
        overflow:hidden;
        padding: 10px;
     }
      .output-frame {
        border: solid 1px #757575;
        border-radius: 2px; 
        margin: 10px; 
        min-height: 100px; 
        overflow:hidden;
        padding: 10px;
     }
     .production-block {
        border: solid 1px #333333; 
        border-radius: 2px; 
        margin:10px; 
        min-height: 500px; 
        overflow:auto;
     }
     .stationBox {
        height: auto;
        min-height: 250px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin: 10px;
        padding: 10px;
        color: #757575;
        border: 4px dashed #757575;
        border-radius: 2px;
        flex-direction: column;
        text-decoration: none;
        position: relative;
        box-sizing: border-box;
     }

      .machineBox {
        height: auto;
        min-height: 250px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin: 10px 10px 10px 10px;
        padding: 10px;
        background-color: #eeeeee;
        border-radius: 2px;
        flex-direction: column;
        text-decoration: none;
        position: relative;
        box-sizing: border-box;
        cursor: move;
        cursor: grab;
        cursor: -moz-grab;
        cursor: -webkit-grab;
     }

       .machine {
        height: auto;
        min-height: 150px;
        min-width: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin: 10px 10px 10px 10px;
        padding: 10px;
        background-color: #eeeeee;
        border-radius: 2px;
        flex-direction: row;
        text-decoration: none;
        position: relative;
        box-sizing: border-box;
        cursor: move;
        cursor: grab;
        cursor: -moz-grab;
        cursor: -webkit-grab;
     }

      .flex-group {
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        justify-content: center; 
        flex-direction: row; 
      }

      .flex-item {
        flex: 1;
      }

     .add-machine-menu {
       overflow: auto;
       max-height: 300px;
     }

     .control-btn {
       margin: 10px 0;
       width: 49%;
     }
     
      .frame p {
        margin: 10px 0;
      }
      
      .slider {
        width: 100%;
      }
    </style>
    <firebase-query app-name="smart-mes" id="productQuery" path="/product" order-by-child="name" data="{{productItems}}"></firebase-query>
    <firebase-query app-name="smart-mes" id="machineQuery" path="/machine" order-by-child="name" data="{{machineItems}}"></firebase-query>  
    <div class="card">
      <h1>Production Simulation</h1>
       <ul class="app-grid control-bar">
      <li>
      <div class="frame">
      <h2>Load Simulator Plan</h2>
      <vaadin-combo-box label="Load Plan" name="plan" items="" id="planSelector" on-tap="selectPlan" item-label-path="name"
        item-value-path="name" required always-float-label></vaadin-combo-box>
      <paper-button class="control-btn dark" raised on-tap="_simulatePlan">Load</paper-button>
      <paper-button class="control-btn chilli" raised on-tap="_simulatePlan">Delete</paper-button>
      </div>
      </li>
      <li>
      <div class="frame">
      <h2>Add Station</h2>
      <paper-input label="Station Name" name="stationname" id="stationName" type="text" required always-float-label auto-validate></paper-input>
      <br>
      <h2>Add Product</h2>
      <vaadin-combo-box label="Product" name="product" items="[[productItems]]" id="productSelector" on-tap="selectProduct" item-label-path="name"
        item-value-path="name" selected-item='{{x}}' required always-float-label></vaadin-combo-box>
      <paper-input label="Quantity" name="order-quantity" value='{{amount}}' id="orderQuantity" type="number" min="1" max="1000"
            step="1" allowed-pattern="[0-9]" required always-float-label auto-validate></paper-input>
      <paper-button raised class="control-btn magic" on-tap="_addStation">Add Station</paper-button>  
      <paper-button raised class="control-btn carrot" on-tap="_addStation">Add Product</paper-button>  
      </div>
      </li>
      <li>
      <div class="frame">
      <h2>Simulator Control</h2>
      <div><p>Duration (Hours)</p>
      <paper-slider class="slider" min="0" step="1" max="72" max-markers="72" value="0" on-change="_changeDuration" id="duration" editable active pin noink snaps></paper-slider>
      </div>
      <div><p>Speed (x1.00)</p>
      <paper-slider class="slider" min="1.00" step="0.50" max="4.00" max-markers="4.00" value="0" editable active pin noink snaps></paper-slider>
      </div>
      <vaadin-combo-box label="Target station" name="station" items="[[stations]]" id="stationSelector" on-tap="selectStation" item-label-path="name"
        item-value-path="name" required always-float-label></vaadin-combo-box>
        <paper-button class="control-btn burn" raised on-tap="_simulatePlan">Simulate</paper-button>
        <paper-button class="control-btn dark" raised on-tap="_savePlan">Save Plan</paper-button>
      </div>
      </li>
      </ul>
      <vaadin-context-menu selector=".block">
        <!-- ADD NEW STATIONS -->
        <template>
          <paper-menu>    
            <paper-item on-tap="_addStation">Add new station</paper-item>
            <paper-item disabled="[[!stations]]" on-tap="_renameStation">Rename station [[target.index]]</paper-item>
            <paper-item disabled="[[!stations]]" list-item="[[target]]" on-tap="_removeStation">Delete station</paper-item>
          </paper-menu>
         </template>

        <div class="block production-block">
          <template is="dom-repeat" items="[[stations]]" as="station">
            <li>
            <div class="block stationBox" index="[[index]]"><h2>Station [[station.name]]</h2>
            <p>Station ID [[index]]</p>
             <div class="flex-group">
             <template is="dom-repeat" items="[[machines_s1]]" as="machineInStation">           
                  <div class="machine flex-item" value="[[machineInStation.name]]">[[machineInStation.name]]</div>  
            </template>
            </div>
            <div>
             <!-- ADD MACHINE TO THIS STATION -->
            <paper-menu-button>
            <paper-icon-button icon="add" class="dropdown-trigger"></paper-icon-button>
            <paper-menu class="add-machine-menu dropdown-content">
                <template is="dom-repeat" items="[[machineItems]]" as="machineItem">
                    <paper-item role="button" title="add machine to station" on-tap="_addMachineToStation">[[machineItem.name]]</paper-item>
                </template>
            </paper-menu>
            </paper-menu-button>
            <!-- RENAME STATION -->
             <paper-icon-button icon="create" on-tap="_renameStation"></paper-icon-button>
             <!-- DELETE STATION -->
             <paper-icon-button icon="delete" on-tap="_removeStation"></paper-icon-button>
            </div>
            </div>
            </li>
          </template>
          <dom-if if="[[!stations]]">
            <div class="block stationBox" style="min-height: 500px;"><h1>No station in production block.</h1>
            <p>Please add your first station to the block.</p>
            </div>   
         </dom-if>
        </div>

      </vaadin-context-menu>
<template is="dom-repeat" items="[[stations]]" as="station">
       <div class="output-frame">
       <h2>Station [[station.name]] Output</h2>
        <p>Total duration:</p>
        <p>Total Workload:</p>
       </div>
</template>
       <div class="output-frame">
       <h2>Production Output</h2>
    <p>Total duration:</p>
    <p>Total Workload:</p>
    <p>Somethings: </p>
    </div>
    </div>

  </template>
  <script>
    Polymer({
      is: 'view-plan-production',
      properties: {
        fnMoves: {
          type: Function,
          value: function () {
            return function (el, container, handle) {
              return handle.classList.contains('handle');
            }
          }
        },
        fnMovesInner: {
          type: Function,
          value: function () {
            return function (el, container, handle) {
              return handle.classList.contains('handle-inner');
            }
          }
        },
        machineItems: {
          type: Object,
        },
        productItems: {
          type: Object
        },
        stations: {
          type: Object,
          value: () => [{name: 'A'}, {name:'B'}, {name:'C'}]
       },
       machines_s1: {
         type: Object,
         value: () => []
       },
        data: {
          type: Object,
          value: function () {
            return {
              rows: [{
                  className: 'red',
                  columns: [{
                      body: "item-1"
                    },
                    {
                      body: "item-2"
                    }
                  ]
                },
                {
                  className: 'green',
                  columns: [{
                      body: "item-3"
                    },
                    {
                      body: "item-4"
                    }
                  ]
                },
                {
                  className: 'blue',
                  columns: [{
                      body: "item-5"
                    },
                    {
                      body: "item-6"
                    },
                    {
                      body: "item-7"
                    }
                  ]
                }
              ]
            };
          }
        },
      },
      _addStation() {
        let sname = this.$.stationName.value;
        if(sname === "") {
          alert("Station name cannot be empty");
        }
        else {
          this.push('stations', {name: sname});
        } 
      },
      _addMachineToStation(e) {
          let mname = e.model.machineItem.name;
          //var machines = new Array()    
          this.push('machines_s1', {name: mname, station: 1});
          //this.push('stations', {name: mname});
      },
      _renameStation(e) {
        console.log('You pressed button ' + e.model.station.name);
      },
      _removeStation(e) {
        this.splice('stations', e.model.index ,1);
      },
      _savePlan() {
        console.log(this.stations.length);
      },
      _checkStation() {
        return (this.stations.length > 0);
      },
      _changeDuration() {
        console.log("Current duration: " + this.$.duration.value);
      },
      
      listeners: {
        'dragula-drag': 'handleEvent',
        'dragula-dragend': 'handleEvent',
        'dragula-drop': 'handleEvent',
        'dragula-cancel': 'handleEvent',
        'dragula-remove': 'handleEvent',
        'dragula-shadow': 'handleEvent',
        'dragula-over': 'handleEvent',
        'dragula-out': 'handleEvent',
        'dragula-cloned': 'handleEvent'
      },
      handleEvent: function (e) {
        console.log(e.type, e.detail);
      },
    });
  </script>
</dom-module>
  

     